<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CRUD Gemilang</title>
  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  
  <link rel="stylesheet" href="latihankuliah.css">
</head>

<body>
  <header class="bg-primary text-white py-3">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-md-2 text-center">
          <img src="assets/Logo-Resmi-Unhas-1.png" alt="Logo Universitas" class="img-fluid" style="max-height: 140px;">
        </div>
        <div class="col-md-10 text-center text-md-start">
          <h1 class="display-5 mb-0">UNIVERSITAS HASANUDDIN</h1>
          <h2 class="display-6 mb-0">FAKULTAS TEKNIK</h2>
          <p class="lead mb-0">Sistem Manajemen Data Mahasiswa</p>
        </div>
      </div>
    </div>
  </header>

  <!-- <nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow">
    <div class="container">
      <a class="navbar-brand d-flex align-items-center" href="#">
        <span>Data Mahasiswa</span>
      </a>
      
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item">
            <a class="nav-link active" href="#"><i class="fas fa-home me-1"></i>Beranda</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#"><i class="fas fa-users me-1"></i> Data Mahasiswa</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#"><i class="fas fa-info-circle me-1"></i> Tentang</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#"><i class="fas fa-envelope me-1"></i> Kontak</a>
          </li>
        </ul>
      </div>
    </div>
  </nav> -->

  <div class="container mt-4">
    <div class="card">
      <div class="card-header bg-info text-white">
        <h3 class="mb-0">Form Input Data Mahasiswa</h3>
      </div>
      <div class="card-body">
        <form id="form-mahasiswa" autocomplete="off">
          <div class="mb-3">
            <label for="nama" class="form-label">Nama:</label>
            <input type="text" id="nama" class="form-control" required placeholder="Masukkan nama lengkap">
          </div>

          <div class="mb-3">
            <label for="nim" class="form-label">NIM:</label>
            <input type="text" id="nim" class="form-control" required placeholder="Masukkan NIM">
          </div>

          <div class="mb-3">
            <label for="program_studi" class="form-label">Program Studi:</label>
            <input type="text" id="program_studi" class="form-control" required placeholder="Masukkan Program Studi">
          </div>

          <input type="hidden" id="id">

          <div class="text-center">
            <button type="button" id="btn-reset" class="btn btn-secondary">Reset</button>
            <button type="submit" id="btn-simpan" class="btn btn-primary">Simpan</button>    
          </div>
        </form>
      </div>
    </div>

    <div class="card mt-4">
      <div class="card-header bg-success text-white">
        <h3 class="mb-0">Daftar Mahasiswa</h3>
      </div>
      <div class="card-body">
        <div class="mb-3">
          <label for="search" class="form-label">Cari:</label>
          <input type="text" id="search" class="form-control" placeholder="Cari berdasarkan nama, NIM, atau program studi">
        </div>

        <div class="table-responsive">
          <table class="table table-striped table-bordered">
            <thead class="table-dark">
              <tr>
                <th>#</th>
                <th id="sort-nama" style="cursor: pointer;">Nama ↕</th>
                <th id="sort-nim" style="cursor: pointer;">NIM ↕</th>
                <th id="sort-prodi" style="cursor: pointer;">Program Studi ↕</th>
                <th>Aksi</th>
              </tr>
            </thead>
            <tbody id="tbody">
              </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <footer class="bg-dark text-white py-4 mt-5">
    <div class="container">
      <div class="row">
        <div class="col-md-12 text-center">
          <p>&copy; 2025 Universitas Hasanuddin. Fakultas Teknik.</p>
          <p>Developed for Educational Purposes</p>
        </div>
      </div>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
  // ------------------- PERSISTENSI DATA -------------------
  // Blok ini bertanggung jawab untuk menyimpan dan memuat data dari browser.
  // Ini memastikan data tidak hilang saat halaman ditutup atau di-refresh.

  // Konstanta untuk kunci penyimpanan di localStorage.
  const STORAGE_KEY = "crud_mahasiswa";

  // Fungsi untuk memuat data dari localStorage.
  function loadData() {
    // Mencoba mengambil data dari localStorage menggunakan kunci yang ditentukan.
    const data = localStorage.getItem(STORAGE_KEY);
    // Jika data ditemukan, parse (ubah dari string JSON ke objek JavaScript) dan kembalikan.
    if (data) {
      return JSON.parse(data);
    }
    // Jika tidak ada data, kembalikan array kosong.
    return [];
  }

  // Fungsi untuk menyimpan data ke localStorage.
  function saveData(list) {
    // Mengubah array objek JavaScript menjadi string JSON.
    // Kemudian menyimpannya di localStorage dengan kunci yang sudah ditentukan.
    localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
  }

  // ------------------- STATE -------------------
  // Blok ini mengelola status dan data utama aplikasi.

  // Array utama yang berisi semua data mahasiswa, dimuat dari localStorage saat aplikasi dimulai.
  let dataMahasiswa = loadData();
  
  // Variabel untuk ID otomatis bagi mahasiswa baru.
  let autoId = 1;
  // Jika ada data yang sudah dimuat, cari ID terbesar dan tambahkan 1 untuk ID berikutnya.
  if (dataMahasiswa.length > 0) {
    // Mengambil semua ID dari data mahasiswa yang ada.
    const ids = dataMahasiswa.map(mhs => mhs.id);
    // Mencari nilai ID terbesar dan menambahkannya dengan 1.
    autoId = Math.max(...ids) + 1;
  }

  // State untuk melacak kolom yang sedang diurutkan.
  let sortColumn = "";
  // State untuk melacak arah pengurutan (menaik "asc" atau menurun "desc").
  let sortDirection = "asc";

  // ------------------- ELEMENT HTML -------------------
  // Blok ini mengambil referensi ke elemen-elemen HTML yang akan dimanipulasi.

  // Referensi ke elemen form.
  const form = document.getElementById("form-mahasiswa");
  // Referensi ke input tersembunyi untuk ID.
  const elId = document.getElementById("id");
  // Referensi ke input nama.
  const elNama = document.getElementById("nama");
  // Referensi ke input NIM.
  const elNim = document.getElementById("nim");
  // Referensi ke input program studi.
  const elProgramStudi = document.getElementById("program_studi");
  // Referensi ke tbody (badan tabel) tempat data akan ditampilkan.
  const tbody = document.getElementById("tbody");
  // Referensi ke tombol reset.
  const btnReset = document.getElementById("btn-reset");
  // Referensi ke input pencarian.
  const elSearch = document.getElementById("search");

  // ------------------- FUNGSI SORTING -------------------
  // Blok ini berisi fungsi untuk mengurutkan data di tabel.

  // Fungsi untuk mengurutkan data berdasarkan kolom yang diberikan.
  function sortData(column) {
    // Memeriksa apakah kolom yang diklik sama dengan kolom yang sedang diurutkan.
    if (sortColumn === column) {
      // Jika sama, ubah arah pengurutan (asc menjadi desc, atau sebaliknya).
      sortDirection = sortDirection === "asc" ? "desc" : "asc";
    } else {
      // Jika berbeda, atur kolom yang diurutkan ke kolom yang baru dan mulai dengan arah menaik.
      sortColumn = column;
      sortDirection = "asc";
    }

    // Mengurutkan array dataMahasiswa menggunakan metode sort().
    dataMahasiswa.sort((a, b) => {
      // Mengambil nilai dari kolom yang diurutkan dan mengubahnya menjadi huruf kecil.
      let valueA = a[column].toString().toLowerCase();
      let valueB = b[column].toString().toLowerCase();

      // Logika pengurutan:
      if (sortDirection === "asc") {
        // Jika arah menaik (ascending), bandingkan nilai A dan B.
        return valueA < valueB ? -1 : valueA > valueB ? 1 : 0;
      } else {
        // Jika arah menurun (descending), balikkan perbandingan.
        return valueA > valueB ? -1 : valueA < valueB ? 1 : 0;
      }
    });

    // Memanggil fungsi render untuk menampilkan data yang sudah diurutkan.
    render();
  }

  // ------------------- FUNGSI SEARCH -------------------
  // Blok ini berisi fungsi untuk mencari data di tabel.

  // Fungsi untuk mencari data berdasarkan input pengguna.
  function searchData() {
    // Mengambil nilai dari kotak pencarian dan mengubahnya menjadi huruf kecil.
    const searchTerm = elSearch.value.toLowerCase();
    
    // Jika kotak pencarian kosong, tampilkan semua data.
    if (searchTerm === "") {
      render();
      return;
    }
    
    // Memfilter array dataMahasiswa.
    // Mencocokkan input pencarian dengan nama, NIM, atau program studi.
    const filteredData = dataMahasiswa.filter(mhs => 
      mhs.nama.toLowerCase().includes(searchTerm) || 
      mhs.nim.toLowerCase().includes(searchTerm) ||
      mhs.program_studi.toLowerCase().includes(searchTerm)
    );
    
    // Memanggil fungsi render dengan data yang sudah difilter.
    render(filteredData);
  }

  // ------------------- FUNGSI RENDER -------------------
  // Fungsi ini bertanggung jawab untuk menampilkan data di tabel.

  // Fungsi untuk menampilkan data di tabel.
  function render(dataToRender = null) {
    // Menentukan data yang akan ditampilkan, jika tidak ada, gunakan dataMahasiswa.
    const data = dataToRender !== null ? dataToRender : dataMahasiswa;
    
    // Mengosongkan konten tbody untuk membersihkan tabel sebelum render ulang.
    tbody.innerHTML = "";
    
    // Melakukan perulangan untuk setiap baris data.
    data.forEach((row, idx) => {
      // Membuat elemen baris tabel baru (<tr>).
      const tr = document.createElement("tr");
      // Menetapkan konten HTML untuk baris tabel.
      tr.innerHTML = `
        <td>${idx + 1}</td>
        <td>${row.nama}</td>
        <td>${row.nim}</td>
        <td>${row.program_studi}</td>
        <td>
          <button type="button" class="btn btn-warning btn-sm" data-edit="${row.id}">Edit</button>
          <button type="button" class="btn btn-danger btn-sm" data-del="${row.id}">Hapus</button>
        </td>
      `;
      // Menambahkan baris tabel yang sudah dibuat ke tbody.
      tbody.appendChild(tr);
    });
    
    // Memanggil fungsi untuk memperbarui indikator pengurutan.
    updateSortIndicators();
  }

  // ------------------- FUNGSI UPDATE SORT INDICATORS -------------------
  // Fungsi ini memperbarui ikon panah di header tabel.

  // Fungsi untuk memperbarui indikator panah di header tabel.
  function updateSortIndicators() {
    // Mengatur ulang teks semua header tabel ke default.
    document.getElementById("sort-nama").textContent = "Nama ↕";
    document.getElementById("sort-nim").textContent = "NIM ↕";
    document.getElementById("sort-prodi").textContent = "Program Studi ↕";
    
    // Jika ada kolom yang sedang diurutkan, tambahkan panah yang sesuai.
    if (sortColumn) {
      // Menentukan panah berdasarkan arah pengurutan.
      const indicator = sortDirection === "asc" ? " ↑" : " ↓";
      // Menggunakan switch untuk memperbarui teks pada header kolom yang benar.
      switch (sortColumn) {
        case "nama":
          document.getElementById("sort-nama").textContent = "Nama" + indicator;
          break;
        case "nim":
          document.getElementById("sort-nim").textContent = "NIM" + indicator;
          break;
        case "program_studi":
          document.getElementById("sort-prodi").textContent = "Program Studi" + indicator;
          break;
      }
    }
  }

  // ------------------- FORM SUBMIT (CREATE / UPDATE) -------------------
  // Blok ini mengelola saat form disubmit, untuk membuat atau memperbarui data.

  // Menambahkan event listener ke form untuk event "submit".
  form.addEventListener("submit", function(e) {
    // Mencegah perilaku default form (mengirim data dan me-reload halaman).
    e.preventDefault();

    // Mengambil nilai dari setiap input form dan menghapus spasi di awal/akhir.
    const idVal = elId.value.trim();
    const nama = elNama.value.trim();
    const nim = elNim.value.trim();
    const programStudi = elProgramStudi.value.trim();

    // Validasi dasar: pastikan nama dan NIM tidak kosong.
    if (!nama || !nim) {
      alert("Nama dan NIM wajib diisi.");
      return;
    }

    // Memeriksa apakah ada nilai di input ID.
    if (idVal) {
      // Jika ada, lakukan operasi UPDATE data yang sudah ada.
      const idNum = Number(idVal);
      // Mencari indeks mahasiswa dengan ID yang cocok.
      const index = dataMahasiswa.findIndex(mhs => mhs.id === idNum);
      if (index >= 0) {
        // Memperbarui properti nama, nim, dan program studi.
        dataMahasiswa[index].nama = nama;
        dataMahasiswa[index].nim = nim;
        dataMahasiswa[index].program_studi = programStudi;
      }
    } else {
      // Jika tidak ada ID, lakukan operasi CREATE data baru.
      dataMahasiswa.push({ 
        // Menambahkan objek baru ke array dengan ID otomatis, nama, nim, dan program studi.
        id: autoId++, 
        nama: nama, 
        nim: nim, 
        program_studi: programStudi 
      });
    }

    // Menyimpan data ke localStorage.
    saveData(dataMahasiswa);
    // Menampilkan ulang tabel dengan data terbaru.
    render();
    
    // Mereset form ke keadaan semula.
    form.reset();
    // Mengosongkan nilai input ID tersembunyi.
    elId.value = "";
    // Mengatur fokus kembali ke input nama.
    elNama.focus();
  });

  // ------------------- RESET FORM -------------------
  // Blok ini mengelola fungsi tombol reset.

  // Menambahkan event listener ke tombol reset.
  btnReset.addEventListener("click", function() {
    // Mereset form.
    form.reset();
    // Mengosongkan input ID tersembunyi.
    elId.value = "";
    // Mengatur fokus ke input nama.
    elNama.focus();
  });

  // ------------------- HANDLER TOMBOL EDIT / HAPUS -------------------
  // Blok ini menangani klik pada tombol edit dan hapus di dalam tabel.

  // Menambahkan event listener ke tbody (badan tabel) untuk efisiensi.
  tbody.addEventListener("click", function(e) {
    // Memeriksa apakah tombol yang diklik memiliki atribut data-edit.
    const editId = e.target.getAttribute("data-edit");
    if (editId) {
      // Jika ya, lakukan operasi EDIT.
      const idNum = Number(editId);
      // Mencari objek mahasiswa yang sesuai dengan ID.
      const mahasiswa = dataMahasiswa.find(mhs => mhs.id === idNum);
      if (mahasiswa) {
        // Mengisi form dengan data mahasiswa yang akan diedit.
        elId.value = mahasiswa.id;
        elNama.value = mahasiswa.nama;
        elNim.value = mahasiswa.nim;
        elProgramStudi.value = mahasiswa.program_studi;
        // Mengatur fokus ke input nama.
        elNama.focus();
      }
      return;
    }

    // Memeriksa apakah tombol yang diklik memiliki atribut data-del.
    const delId = e.target.getAttribute("data-del");
    if (delId) {
      // Jika ya, lakukan operasi DELETE.
      const idNum = Number(delId);
      // Menampilkan konfirmasi sebelum menghapus data.
      if (confirm("Yakin hapus data ini?")) {
        // Memfilter array untuk membuat array baru tanpa mahasiswa yang dihapus.
        dataMahasiswa = dataMahasiswa.filter(mhs => mhs.id !== idNum);
        // Menyimpan array yang diperbarui ke localStorage.
        saveData(dataMahasiswa);
        // Menampilkan kembali tabel.
        render();
      }
    }
  });

  // ------------------- HANDLER SORTING -------------------
  // Blok ini mengelola klik pada header kolom untuk mengurutkan.

  // Menambahkan event listener ke header kolom "Nama" untuk mengurutkan data.
  document.getElementById("sort-nama").addEventListener("click", function() {
    sortData("nama");
  });
  
  // Menambahkan event listener ke header kolom "NIM" untuk mengurutkan data.
  document.getElementById("sort-nim").addEventListener("click", function() {
    sortData("nim");
  });
  
  // Menambahkan event listener ke header kolom "Program Studi" untuk mengurutkan data.
  document.getElementById("sort-prodi").addEventListener("click", function() {
    sortData("program_studi");
  });

  // ------------------- HANDLER SEARCH -------------------
  // Blok ini mengelola input pencarian.

  // Menambahkan event listener untuk event "input" pada kotak pencarian.
  elSearch.addEventListener("input", function() {
    // Setiap kali ada input, panggil fungsi pencarian.
    searchData();
  });

  // ------------------- INIT -------------------
  // Blok ini berisi fungsi yang dieksekusi saat halaman dimuat.

  // Panggil fungsi render pertama kali untuk menampilkan data yang ada.
  render();
</script>
